<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <title>Select Exercise</title>
</head>

<body>

<!-- Mobile Navbar -->
<div th:replace="fragments/mobile_navbar :: mobileNavbar('exercise')"></div>

<div class="container mt-4">
    <!-- Current workout section -->
    <div th:if="${!#lists.isEmpty(workoutExercises)}" class="mb-4">
        <h4 class="fw-bold mb-3 text-center">Current Workout</h4>

        <div class="card rounded-4">
            <ul class="list-group">

                <th:block th:each="workoutExercise : ${workoutExercises}">
                    <li class="list-group-item py-3">

                        <div class="d-flex justify-content-between align-items-center gap-2 flex-wrap flex-sm-nowrap">

                        <!-- Exercise name -->
                        <strong class="fs-6 lh-sm">
                            <span th:text="${workoutExercise.exercise.exerciseName}"></span>
                        </strong>

                        <!-- Buttons -->
                        <div class="d-flex align-items-center gap-2">

                            <!-- Resume -->
                            <a class="btn btn-outline-primary btn-sm d-flex align-items-center"
                               th:href="@{/set(workoutExerciseId=${workoutExercise.id})}">
                                <i class="bi bi-pencil-square"></i>
                            </a>

                            <!-- Delete -->
                            <form th:action="@{/workout-exercise/delete}"
                                  method="post"
                                  class="m-0"
                                  th:onsubmit="return confirm('Remove this exercise from the workout?');">

                                <input type="hidden"
                                       name="workoutExerciseId"
                                       th:value="${workoutExercise.id}" />

                                <button type="submit"
                                        class="btn btn-outline-danger btn-sm d-flex align-items-center justify-content-center">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Sets -->
                    <ul class="mt-2 mb-0 ps-3 small text-muted">
                        <li th:each="set : ${setsMap[workoutExercise.id]}">
                            <span th:text="'Set ' + ${set.setNumber} + ': '"></span>
                            <span th:text="${set.weightKg} + ' kg'"></span>
                            <span th:text="' x ' + ${set.reps} + ' reps'"></span>
                        </li>
                    </ul>

                </li>
            </th:block>



        </ul>
    </div>
</div>

    <h4 class="text-center mb-3 fw-bold">Select an Exercise</h4>

    <!-- Card for the form -->
    <div class="card shadow-sm rounded-4 mt-3">
        <div class="card-body">

            <!-- FORM 1: Select category + exercise -->
            <form method="get" th:action="@{/exercise}">
                <!-- Category dropdown -->
                <div class="mb-3">
                    <label for="category-select" class="form-label fw-semibold">Category</label>
                    <select id="category-select"
                            name="categoryId"
                            class="form-select rounded-3"
                            required
                            onchange="this.form.submit();">
                        <option value="">Select a category</option>
                        <option th:each="category : ${categories}"
                                th:value="${category.id}"
                                th:text="${category.categoryName}"
                                th:selected="${selectedCategoryId} == ${category.id}">
                        </option>
                    </select>
                </div>

                <!-- Exercise dropdown -->
                <div class="mb-4">
                    <label for="exercise-select" class="form-label fw-semibold">Exercise</label>
                    <select id="exercise-select"
                            name="exerciseId"
                            class="form-select rounded-3"
                            th:disabled="${#lists.isEmpty(exercises)}"
                            onchange="this.form.submit();">
                        <option value="">Select an exercise</option>
                        <option th:each="exercise : ${exercises}"
                                th:value="${exercise.id}"
                                th:text="${exercise.exerciseName}"
                                th:selected="${selectedExerciseId} == ${exercise.id}">
                        </option>
                    </select>
                </div>
            </form>

            <!-- Buttons section with uniform spacing -->
            <div class="d-grid gap-3">

                <!-- FORM 2: Add exercise to workout -->
                <form method="post" th:action="@{/workout-exercise}">
                    <input type="hidden" name="exerciseId" th:value="${selectedExerciseId}">
                    <button type="submit"
                            class="btn btn-primary w-100 rounded-3"
                            th:disabled="${selectedExerciseId == null}">
                        Start Exercise
                    </button>
                </form>

                <!-- Button to go to Add New Exercise page -->
                <a class="btn btn-success w-100 rounded-3" th:href="@{/exercise/new}">
                    <i class="bi bi-plus-circle me-2"></i> Create Exercise
                </a>

                <!-- FORM 3: Finish adding exercises -->
                <form th:action="@{/}" method="get">
                    <button type="submit" class="btn btn-outline-secondary w-100 rounded-3">
                        Finish Adding Exercises
                    </button>
                </form>

            </div> <!-- end d-grid -->

        </div> <!-- end card-body -->
    </div> <!-- end card -->
</div> <!-- end container -->

</body>
</html>
