<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8" />
    <title th:text="${exercise.exerciseName} + ' Analytics'">Exercise Analytics</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet" />

    <style>
        body { background: linear-gradient(180deg, #ffffff 0%, #f5f7fa 100%); min-height: 100vh; }
        .page-shell { max-width: 720px; }
        .card-modern {
          background: rgba(255, 255, 255, 0.9);
          backdrop-filter: blur(8px);
          border-radius: 16px;
          padding: 18px;
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        }
        .page-title { font-weight: 800; letter-spacing: -0.02em; margin-bottom: .25rem; }
        .page-subtitle { color: #6c757d; margin-bottom: 1.25rem; }
        .badge-soft {
          background: rgba(13, 110, 253, 0.10);
          color: #0d6efd;
          border-radius: 999px;
          padding: .35rem .6rem;
          font-weight: 600;
          font-size: .85rem;
          white-space: nowrap;
        }
        .actions { display: flex; gap: .5rem; margin-top: 1rem; }
        .btn-soft { border-radius: 14px; padding: .85rem 1rem; }
        .empty-state {
          color: #6c757d;
          margin: 0;
          padding: .75rem;
          border-radius: 12px;
          background: rgba(0,0,0,0.03);
        }
        .chart-wrap {
          position: relative;
          height: 320px;
          width: 100%;
        }

    </style>
</head>

<body>
<div th:replace="fragments/mobile_navbar :: mobileNavbar('home')"></div>

<div class="container mt-4 page-shell">

    <div class="text-center mb-3">
        <h1 class="page-title">
            <i class="bi bi-graph-up me-2"></i>
            <span th:text="${exercise.exerciseName}"></span> Analytics
        </h1>
        <p class="page-subtitle mb-0">Max weight per workout (over time)</p>
    </div>

    <div class="card-modern">

        <div th:if="${#lists.isEmpty(points)}" class="empty-state">
            No data yet for this exercise. Log some sets and youâ€™ll see your chart here.
        </div>

        <div th:if="${!#lists.isEmpty(points)}" class="chart-wrap">
            <canvas id="weightChart" height="140"></canvas>
        </div>
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script th:inline="javascript">
    // points is a List<ExercisePoint(date, weightKg)>
    const points = /*[[${points}]]*/ [];

    // Build arrays for the chart
    const labels = points.map(p => {
      // date could come through as "2025-12-15T10:30:00"
      const d = new Date(p.date);
      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: '2-digit' });
    });

    const weights = points.map(p => p.weightKg);

    const ctx = document.getElementById('weightChart');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Max weight (kg)',
          data: weights,
          tension: 0.25,
          pointRadius: 3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true },
          tooltip: { mode: 'index', intersect: false }
        },
        interaction: { mode: 'nearest', intersect: false },
        scales: {
          y: {
            beginAtZero: false,
            title: { display: true, text: 'kg' }
          },
          x: {
            title: { display: true, text: 'Date' }
          }
        }
      }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
